# IM Salvo Backend

åŸºäº Rust å’Œ Salvo æ¡†æ¶æ„å»ºçš„ç°ä»£åŒ–å³æ—¶é€šè®¯åç«¯æœåŠ¡ã€‚

## é¡¹ç›®ä»‹ç»

IM Salvo Backend æ˜¯ä¸€ä¸ªå®Œæ•´çš„å³æ—¶é€šè®¯åç«¯è§£å†³æ–¹æ¡ˆï¼ŒåŸºäº Salvo 0.82 æ¡†æ¶æ„å»ºã€‚é¡¹ç›®æ”¯æŒç”¨æˆ·è®¤è¯ã€å®æ—¶æ¶ˆæ¯ä¼ é€’ã€æ–‡ä»¶å…±äº«ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸ºå³æ—¶é€šè®¯åº”ç”¨æä¾›é«˜æ€§èƒ½ã€å¯æ‰©å±•çš„åç«¯æœåŠ¡ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½ Web æœåŠ¡**: åŸºäº Salvo 0.82 æ¡†æ¶ï¼Œæ”¯æŒå¼‚æ­¥å¤„ç†
- ğŸ” **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**: JWT token è®¤è¯ + bcrypt å¯†ç åŠ å¯†
- ğŸ“ **API æ–‡æ¡£**: è‡ªåŠ¨ç”Ÿæˆ OpenAPI/Swagger æ–‡æ¡£
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–**: PostgreSQL + Rbatis 4.6 ORM
- ğŸ“¦ **ç¼“å­˜æ”¯æŒ**: Redis + deadpool-redis è¿æ¥æ± 
- ğŸ”Œ **å®æ—¶é€šä¿¡**: Server-Sent Events (SSE) æ”¯æŒ
- ğŸŒ **è·¨åŸŸæ”¯æŒ**: å†…ç½® CORS ä¸­é—´ä»¶
- ğŸ”„ **ä¼˜é›…åœæœº**: æ”¯æŒ Ctrl+C ä¿¡å·ä¼˜é›…åœæ­¢
- ğŸ“Š **æ—¥å¿—ç³»ç»Ÿ**: åŸºäº tracing çš„ç»“æ„åŒ–æ—¥å¿—

## æŠ€æœ¯æ ˆ

| ç±»åˆ«           | æŠ€æœ¯           | ç‰ˆæœ¬                  | è¯´æ˜                 |
| -------------- | -------------- | --------------------- | -------------------- |
| **è¯­è¨€**       | Rust           | stable | ç³»ç»Ÿç¼–ç¨‹è¯­è¨€         |
| **Web æ¡†æ¶**   | Salvo          | 0.82                  | ç°ä»£åŒ– Rust Web æ¡†æ¶ |
| **æ•°æ®åº“**     | PostgreSQL     | 12+                   | å…³ç³»å‹æ•°æ®åº“         |
|                | Rbatis         | 4.6                   | Rust ORM æ¡†æ¶        |
| **ç¼“å­˜**       | Redis          | 6+                    | å†…å­˜æ•°æ®åº“           |
|                | deadpool-redis | 0.22                  | Redis è¿æ¥æ±          |
| **å¼‚æ­¥è¿è¡Œæ—¶** | Tokio          | 1.47                  | å¼‚æ­¥è¿è¡Œæ—¶           |
| **åºåˆ—åŒ–**     | Serde          | 1.0                   | åºåˆ—åŒ–/ååºåˆ—åŒ–      |
| **è®¤è¯**       | jsonwebtoken   | 9.3                   | JWT å¤„ç†             |
|                | bcrypt         | 0.17                  | å¯†ç å“ˆå¸Œ             |
| **æ—¥å¿—**       | tracing        | 0.1                   | ç»“æ„åŒ–æ—¥å¿—           |
| **é…ç½®**       | figment        | 0.10                  | é…ç½®ç®¡ç†             |

## é¡¹ç›®ç»“æ„

```
im-salvo-backend/
â”œâ”€â”€ im-codegen/           # è¿‡ç¨‹å®å’Œä»£ç ç”Ÿæˆå·¥å…·
â”‚   â”œâ”€â”€ src/
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ im-common/            # å…±äº«å·¥å…·å’Œé€šç”¨åŠŸèƒ½
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/       # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ jwt.rs        # JWT è®¤è¯å·¥å…·
â”‚   â”‚   â””â”€â”€ redis.rs      # Redis å·¥å…·
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ im-server/            # ä¸»æœåŠ¡å™¨åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ hoops/        # ä¸­é—´ä»¶å’Œé’©å­
â”‚   â”‚   â”œâ”€â”€ models/       # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routers/      # è·¯ç”±å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ test/         # æµ‹è¯•æ¨¡å—
â”‚   â”‚   â””â”€â”€ main.rs       # åº”ç”¨å…¥å£ç‚¹
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ script/               # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ Cargo.toml            # å·¥ä½œç©ºé—´é…ç½®
â”œâ”€â”€ config.toml           # åº”ç”¨é…ç½®
â””â”€â”€ docker-compose.yml    # Docker æœåŠ¡é…ç½®
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Rust**: stable å·¥å…·é“¾ 
- **PostgreSQL**: 12+ ç‰ˆæœ¬
- **Redis**: 6+ ç‰ˆæœ¬

### å®‰è£…ä¾èµ–

```bash
# ç¡®ä¿ä½¿ç”¨ Rust stable å·¥å…·é“¾
rustup default stable

# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd im-salvo-backend
```

### é…ç½®æœåŠ¡

1. **å¯åŠ¨æ•°æ®åº“æœåŠ¡** (ä½¿ç”¨ Docker)

   ```bash
   docker-compose up -d
   ```

2. **é…ç½®åº”ç”¨** (ç¼–è¾‘ `config.toml`)

   ```toml
   # HTTP æœåŠ¡å™¨ç›‘å¬åœ°å€
   listen_addr = "127.0.0.1:8008"

   [db]
   # PostgreSQL æ•°æ®åº“è¿æ¥
   url = "postgres://postgres:135246@127.0.0.1:5432/postgres"

   [jwt]
   # JWT ç­¾åå¯†é’¥
   secret = "yoursecret"
   expiry = 3600

   [redis]
   # Redis è¿æ¥
   url = "redis://localhost:6379/"
   ```

### è¿è¡Œé¡¹ç›®

```bash
# æ£€æŸ¥ä»£ç 
cargo check

# è¿è¡ŒæœåŠ¡å™¨
cargo run

# è¿è¡Œæµ‹è¯•
cargo test
```

### è®¿é—®æœåŠ¡

- **API æœåŠ¡**: http://localhost:8008
- **Swagger æ–‡æ¡£**: http://localhost:8008/swagger-ui/
- **OpenAPI è§„èŒƒ**: http://localhost:8008/api-doc/openapi.json

## å¼€å‘æŒ‡å—

### å·¥ä½œç©ºé—´å‘½ä»¤

```bash
# æ£€æŸ¥æ•´ä¸ªå·¥ä½œç©ºé—´
cargo check --workspace

# æ„å»ºç‰¹å®š crate
cargo build -p im-server

# è¿è¡Œç‰¹å®š crate çš„æµ‹è¯•
cargo test -p im-common

# æŸ¥çœ‹ä¾èµ–æ ‘
cargo tree
```

### API å¼€å‘

1. **æ·»åŠ è·¯ç”±**: åœ¨ `im-server/src/routers/` ä¸­æ·»åŠ æ–°çš„è·¯ç”±æ¨¡å—
2. **å®šä¹‰æ¨¡å‹**: åœ¨ `im-server/src/models/` ä¸­å®šä¹‰æ•°æ®æ¨¡å‹
3. **æ·»åŠ ä¸­é—´ä»¶**: åœ¨ `im-server/src/hoops/` ä¸­æ·»åŠ ä¸­é—´ä»¶
4. **OpenAPI æ³¨è§£**: ä½¿ç”¨ Salvo çš„ `#[endpoint]` å’Œç›¸å…³æ³¨è§£

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### ç”¨æˆ·è®¤è¯

- ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- JWT token ç”Ÿæˆå’ŒéªŒè¯
- å¯†ç åŠ å¯†å­˜å‚¨ (bcrypt)

### å®æ—¶é€šä¿¡

- Server-Sent Events (SSE) æ”¯æŒ
- æ¶ˆæ¯æ¨é€å’Œè®¢é˜…
- è¿æ¥çŠ¶æ€ç®¡ç†

### æ•°æ®ç®¡ç†

- PostgreSQL æ•°æ®æŒä¹…åŒ–
- Redis ç¼“å­˜åŠ é€Ÿ
- è¿æ¥æ± ç®¡ç†

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: æ·»åŠ æŸä¸ªåŠŸèƒ½'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

### æäº¤è§„èŒƒ

ä½¿ç”¨ [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºé…ç½®ç­‰

## è®¸å¯è¯

MIT License
